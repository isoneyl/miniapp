<properties>    <!--通用的排序、高亮、分页 -->    <property name="publicDsl">        <![CDATA[            "from": #[pageNum] , "size": #[pageSize],            "sort": [                #if($sortName && $sortType) ##排序                {                    "$sortName": {                      "order": "$sortType"                    }                }                #else                {                    "docType": {                      "order": "desc"                    }                },                {                    "orderBy": {                      "order": "asc"                    }                },                {                    "updateTime": {                      "order": "desc"                    }                },                {                    "docName": {                      "order": "asc"                    }                }                #end            ],            "_source": {                "excludes": [                    "docContent"                ]            },            "highlight": {                "order" : "score",                "fields": {                    "docName": {                        "pre_tags" : ["<font style='color:red;'>"],                        "post_tags" : ["</font>"],                        "fragment_size": 80,                        "number_of_fragments": 40                    },                    "docContent": {                        "pre_tags" : ["<font style='color:red;'>"],                        "post_tags" : ["</font>"],                        "fragment_size": 50,                        "number_of_fragments": 10,                        "no_match_size": 100                    }                }            },        ]]>    </property>    <!--底稿管理项目文档通用查询条件 -->    <property name="publicSearchDsl">        <![CDATA[            "filter": [                #if($projectId) ##项目id(必传条件)                {                    "term": {                        "projectId": {                            "value": #[projectId]                        }                    }                }                ,                #end                #if($docSource) ##文件来源(必传条件)                {                    "term": {                        "docSource": {                            "value": #[docSource]                        }                    }                }                ,                #end                {                    "term": {                        "isDelete": {                            "value": 0                        }                    }                }                #if($docIds && $docIds.size() > 0) ##主键id                ,                {                    "terms": {                        "docId": [                            #foreach($field in $docIds)                                #if($velocityCount > 0),#end "$field"                            #end                        ]                    }                }                #end                #if($beginTime && $endTime) ##时间                ,                {                    "range": {                        "updateTime": {                            "gte": #[beginTime],                            "lte": #[endTime]                        }                    }                }                #end                #if($suffix && $suffix.size() > 0) ##文件类型                ,                {                    "terms": {                        "suffix": [                            #foreach($field in $suffix)                                #if($velocityCount > 0),#end "$field"                            #end                        ]                    }                }                #end                #if($auditProjectIds && $auditProjectIds.size() > 0) ##阶段                ,                {                    "terms": {                        "auditProjectId": [                            #foreach($field in $auditProjectIds)                                #if($velocityCount > 0),#end "$field"                            #end                        ]                    }                }                #end                #if($docType) ##类型(文件还是文件夹)                ,                {                    "term": {                        "docType": {                            "value": #[docType]                        }                    }                }                #end            ],        ]]>    </property>    <!-- 底稿管理查询 -->    <property name="queryPaperDoc">        <![CDATA[            {                @{publicDsl} ##引用DSL                "query": {                    "bool": {                        @{publicSearchDsl}  ##引用DSL                        "must": [                            #if($docName && $docName.size() > 0) ##搜索标题和标签关键字                            {                                "bool": {                                    "should": [                                        {                                            "bool": {                                                "must": [                                                    #foreach($field in $docName)                                                    {                                                        #if($field.hasChinese) ##包含中文用短语搜索                                                        "match_phrase": {                                                            "docName": "$field.keyword"                                                        }                                                        #else ##不包含中文用模糊搜索                                                        "wildcard": {                                                            "docName": {                                                                "value": "*$field.keyword*"                                                            }                                                        }                                                        #end                                                    }                                                    #if($velocityCount < $docName.size() - 1),#end ##最后一次不拼接                                                    #end                                                ]                                            }                                        },                                        {                                            "bool": {                                                "must": [                                                    #foreach($field in $docName)                                                    {                                                        #if($field.hasChinese) ##包含中文用短语搜索                                                        "match_phrase": {                                                            "labelName": "$field.keyword"                                                        }                                                        #else ##不包含中文用模糊搜索                                                        "wildcard": {                                                            "labelName": {                                                                "value": "*$field.keyword*"                                                            }                                                        }                                                        #end                                                    }                                                    #if($velocityCount < $docName.size() - 1),#end ##最后一次不拼接                                                    #end                                                ]                                            }                                        }                                    ]                                }                            }                            #end                            #if($docName && $docName.size() > 0 && $docContent && $docContent.size() > 0) ##搜索标题和标签都有数据加,                            ,                            #end                            #if($docContent && $docContent.size() > 0) ##内容关键字                            {                                "bool": {                                    "must": [                                        #foreach($field in $docContent)                                        {                                            #if($field.hasChinese) ##包含中文用短语搜索                                            "match_phrase": {                                                "docContent": "$field.keyword"                                            }                                            #else ##不包含中文用模糊搜索                                            "wildcard": {                                                "docContent": {                                                    "value": "*$field.keyword*"                                                }                                            }                                            #end                                        }                                        #if($velocityCount < $docContent.size() - 1),#end ##最后一次不拼接                                        #end                                     ]                                }                            }                            #end                        ]                    }                }            }        ]]>    </property>    <!-- 项目文档查询 -->    <property name="queryProjectDoc">        <![CDATA[            {                @{publicDsl} ##引用DSL                "query": {                    "bool": {                        @{publicSearchDsl}  ##引用DSL                        "must": [                            #if($docName && $docName.size() > 0) ##搜索标题                            {                                "bool": {                                    "must": [                                        #foreach($field in $docName)                                        {                                            #if($field.hasChinese) ##包含中文用短语搜索                                            "match_phrase": {                                                "docName": "$field.keyword"                                            }                                            #else ##不包含中文用模糊搜索                                            "wildcard": {                                                "docName": {                                                    "value": "*$field.keyword*"                                                }                                            }                                            #end                                        }                                        #if($velocityCount < $docName.size() - 1),#end ##最后一次不拼接                                        #end                                    ]                                }                            }                            #end                            #if($docName && $docName.size() > 0 && $docContent && $docContent.size() > 0) ##搜索标题都有数据就加 ,                            ,                            #end                            #if($docContent && $docContent.size() > 0) ##内容关键字                            {                                "bool": {                                    "must": [                                        #foreach($field in $docContent)                                        {                                            #if($field.hasChinese) ##包含中文用短语搜索                                            "match_phrase": {                                                "docContent": "$field.keyword"                                            }                                            #else ##不包含中文用模糊搜索                                            "wildcard": {                                                "docContent": {                                                    "value": "*$field.keyword*"                                                }                                            }                                            #end                                        }                                        #if($velocityCount < $docContent.size() - 1),#end ##最后一次不拼接                                        #end                                     ]                                }                            }                            #end                        ]                    }                }            }        ]]>    </property>    <!-- 客户文档查询 -->    <property name="queryCrmDoc">        <![CDATA[            {                @{publicDsl} ##引用DSL                "query": {                    "bool": {                        "filter": [                            {                                #if($crmType) ##客户类型                                "term": {                                    "crmType": {                                        "value": #[crmType]                                    }                                }                                #end                            }                            ,                            {                                #if($crmId) ##客户ID                                "term": {                                    "crmId": {                                        "value": #[crmId]                                    }                                }                                #end                            }                            ,                            {                                "term": {                                    "isDelete": {                                        "value": 0                                    }                                }                            }                        ],                        "must": [                            {                                #if($docContent && $docContent.size() > 0) ##搜索标题和内容关键字                                "bool": {                                    "should": [                                        {                                            "bool": {                                                "must": [                                                    #foreach($field in $docContent)                                                    {                                                        #if($field.hasChinese) ##包含中文用短语搜索                                                        "match_phrase": {                                                            "docContent": "$field.keyword"                                                        }                                                        #else ##不包含中文用模糊搜索                                                        "wildcard": {                                                            "docContent": {                                                                "value": "*$field.keyword*"                                                            }                                                        }                                                        #end                                                    }                                                    #if($velocityCount < $docContent.size() - 1),#end ##最后一次不拼接                                                    #end                                                ]                                            }                                        },                                        {                                            "bool": {                                                "must": [                                                    #foreach($field in $docContent)                                                    {                                                        #if($field.hasChinese) ##包含中文用短语搜索                                                        "match_phrase": {                                                            "docName": "$field.keyword"                                                        }                                                        #else ##不包含中文用模糊搜索                                                        "wildcard": {                                                            "docName": {                                                                "value": "*$field.keyword*"                                                            }                                                        }                                                        #end                                                    }                                                    #if($velocityCount < $docContent.size() - 1),#end ##最后一次不拼接                                                    #end                                                ]                                            }                                        }                                    ]                                }                                #end                            }                        ]                    }                }            }        ]]>    </property>    <!--根据rfsId获取对象(只包含内容)-->    <property name="queryDocumentByRfsId">        <![CDATA[            {                "from": 0 , "size": 1,                "_source": {                    "include": [                        "docContent"                    ]                },                "query": {                    "term": {                        "rfsId": {                            "value": #[rfsId]                        }                    }                }            }        ]]>    </property>    <!--根据rfsId获取对象集合-->    <property name="queryDocumentsByRfsId">        <![CDATA[            {                "query": {                    "term": {                        "rfsId": {                            "value": #[rfsId]                        }                    }                }            }        ]]>    </property>    <!--根据docId和docSource获取对象 -->    <property name="queryDocumentByDocIdAndDocSource">        <![CDATA[            {                "query": {                    "bool": {                        "filter": [                            {                                "term": {                                    "docId": {                                        "value": #[docId]                                    }                                }                            },                            {                                "term": {                                    "docSource": {                                        "value": #[docSource]                                    }                                }                            }                        ]                    }                }            }        ]]>    </property>    <!--根据docIds和docSource获取数据集合 -->    <property name="queryDocumentByDocIdsAndDocSource">        <![CDATA[            {                "query": {                    "bool": {                        "filter": [                            {                                "terms": {                                    "docId": [                                        #foreach($field in $docIds)                                            #if($velocityCount > 0),#end "$field"                                        #end                                    ]                                }                            },                            {                                "term": {                                    "docSource": {                                        "value": #[docSource]                                    }                                }                            }                        ]                    }                }            }        ]]>    </property>    <!--根据projectId查询底稿文档数据 -->    <property name="queryPaperByProjectId">        <![CDATA[            {                "size" : 500,                "query": {                    "bool": {                        "filter": [                            {                                "term": {                                    "projectId": {                                        "value": #[projectId]                                    }                                }                            },                            {                                "term": {                                    "docSource": {                                        "value": 1                                    }                                }                            },                            {                                "term": {                                    "isDelete": {                                        "value": 0                                    }                                }                            }                        ]                    }                }            }        ]]>    </property>    <!--根据projectId查询项目文档设为底稿的数据 -->    <property name="queryProjectByProjectId">        <![CDATA[            {                "size": 500,                "query": {                    "bool": {                        "filter": [                            {                                "term": {                                    "projectId": {                                        "value": #[projectId]                                    }                                }                            },                            {                                "term": {                                    "docSource": {                                        "value": 0                                    }                                }                            },                            {                                "term": {                                    "isDelete": {                                        "value": 0                                    }                                }                            },                            {                                "term": {                                    "docType": {                                        "value": 0                                    }                                }                            }                        ],                        "must_not": [                            {                                "term": {                                    "isLink": {                                        "value": 0                                    }                                }                            }                        ],                        "must": [                            {                                "exists": {                                    "field": "isLink"                                }                            }                        ]                    }                }            }        ]]>    </property>    <!--根据对应条件获取项目下文件或文件夹的数量 -->    <property name="searchFileCount">        <![CDATA[            {                "from":0 , "size": 0,                "aggs": {                    "projectIds": {                        "terms": {                            "field": "projectId",                            "size": 100000                        },                        "aggs": {                            "docTypes": {                                "terms": {                                    "field": "docType"                                }                            }                        }                    }                },                "query": {                    "bool": {                        "must": [                            {                                "term": {                                    "isDelete": {                                        "value": 0                                    }                                }                            },                            {                                #if($docSource)                                "term": {                                    "docSource": {                                        "value": #[docSource]                                    }                                }                                #end                            },                            {                                #if($docName && $docName.size() > 0)                                "bool": {                                    "must": [                                        #foreach($field in $docName)                                        {                                            #if($field.hasChinese) ##包含中文用短语搜索                                            "match_phrase": {                                                "docName": "$field.keyword"                                            }                                            #else ##不包含中文用模糊搜索                                            "wildcard": {                                                "docName": {                                                    "value": "*$field.keyword*"                                                }                                            }                                            #end                                        }                                        #if($velocityCount < $docName.size() - 1),#end ##最后一次不拼接                                        #end                                    ]                                }                                #end                            },                            {                                #if($projectParams && $projectParams.size() > 0)                                "bool": {                                    "should": [                                        #foreach($field in $projectParams)                                        {                                            "term": {                                                "projectId": {                                                    "value": $field.projectId                                                }                                            }                                        }                                        #if($velocityCount < $projectParams.size() - 1),#end ##最后一次不拼接                                        #end                                    ]                                }                                #end                            }                        ]                    }                }            }        ]]>    </property></properties>